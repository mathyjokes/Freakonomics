---
title: "freakonomics_analysis"
output: html_document
---

# What can you learn about on Freakonomics? An analysis of transcripts from 468 episodes over the past 10 years can tell you: people, time, and money (and a wordcloud because I couldn't resist)

```{r}
library(tidyverse)
library(tidytext)
library(readr)
library(rvest)
library(wordcloud)
library(textclean)
library(ggthemes)

pods <- read_csv("FREAKONOMICS_EPISODES.csv")

# it's, that's, don't, i'm, you're, there's, we're, they're, didn't
pod_text <- pods %>% 
  mutate(Text = str_replace_all(Text, "Listen and subscribe to our podcast at Apple Podcasts, Stitcher, or elsewhere", "")) %>% 
  mutate(Text = str_replace_all(Text, "Below is a transcript of the episode, edited for readability", "")) %>%
  mutate(Text = str_replace_all(Text, "For more information on the people and ideas in the episode, see the links at the bottom of this post", "")) %>%
  mutate(Text = str_replace_all(Text, "Freakonomics Radio is produced by Stitcher and Dubner Productions", "")) %>%
  mutate(Text = str_replace_all(Text, "This episode was produced by Daphne Chen", "")) %>%
  mutate(Text = str_replace_all(Text, "Our staff also includes Alison Craiglow, Greg Rippin, Matt Hickey, Corinne Wallace, Zack Lapinski, and Mary Diduch", "")) %>%
  mutate(Text = str_replace_all(Text, "Our intern is Emma Tyrrell", "")) %>%
  mutate(Text = str_replace_all(Text, "we had help this week from James Foster", "")) %>%
  mutate(Text = str_replace_all(Text, 'Our theme song is "Mr. Fortune," by the Hitchhikers', "")) %>%
  mutate(Text = str_replace_all(Text, "all the other music was composed by Luis Guerra", "")) %>%
  mutate(Text = str_replace_all(Text, "You can subscribe to Freakonomics Radio on Apple Podcasts, Stitcher, or wherever you get your podcasts", "")) %>%
# can't  
  mutate(Text = tolower(Text)) %>% 
  mutate(Text = replace_contraction(Text)) %>% 
  mutate(Text = str_replace_all(Text, "it's", "it is")) %>% 
  mutate(Text = str_replace_all(Text,  "that's","that is")) %>% 
  mutate(Text = str_replace_all(Text,  "that\'s","that is")) %>% 
  mutate(Text = str_replace_all(Text, "don't", "do not")) %>% 
  mutate(Text = str_replace_all(Text, "i'm", "i am")) %>%
  mutate(Text = str_replace_all(Text, "i\'m", "i am")) %>%
  mutate(Text = str_replace_all(Text, "you're", "you are")) %>% 
  mutate(Text = str_replace_all(Text, "there's", "there is")) %>% 
  mutate(Text = str_replace_all(Text, "we're", "we are")) %>% 
  mutate(Text = str_replace_all(Text, "they're", "they are")) %>% 
  mutate(Text = str_replace_all(Text, "didn't", "did not")) %>% 
  mutate(Text = str_replace_all(Text, "can't", "can not")) %>% 
  mutate(Text = str_replace_all(Text, "i'd", "i would")) %>% 
  mutate(Text = str_replace_all(Text, "what's", "what is")) %>% 
  mutate(Text = str_replace_all(Text, "let's", "let us")) %>% 
  mutate(Text = str_replace_all(Text, "i've", "i have")) %>% 
  mutate(Text = str_replace_all(Text, "we've", "we have")) %>% 
  mutate(Text = str_replace_all(Text, "you've", "you have")) %>% 
  mutate(Text = str_replace_all(Text, "doesn't", "does not")) %>% 
  mutate(Text = str_replace_all(Text, "he's", "he is")) %>% 
  mutate(Text = str_replace_all(Text, "she's", "she is")) %>% 
  mutate(Text = str_replace_all(Text, "you'll", "you will")) %>% 
  mutate(Text = str_replace_all(Text, "here's", "here is")) %>% 
  mutate(Text = str_replace_all(Text, "wasn't", "was not")) %>% 
  mutate(Text = str_replace_all(Text, "is'nt", "is not")) %>% 
  mutate(Text = str_replace_all(Text, "we'll", "we will")) %>% 
  mutate(Text = str_replace_all(Text, "wouldn't", "would not")) %>% 
  mutate(Text = str_replace_all(Text, "here's", "here is"))


# remember to load up promo_words from next chunk first
pod_test <- pod_text %>% 
  unnest_tokens(word, Text) %>% 
  group_by(Title) %>% 
  mutate(id = row_number()) %>% 
  ungroup() %>% 
  anti_join(stop_words)#%>%  anti_join(promo_words)
```


```{r}
##################################  HISTOGRAM OF TOP WORDS  ##################################
#ggsave('top_words_.png', 
pod_test %>% 
  filter(word != "dubner") %>% 
  filter(word != "freakonomics") %>% 
  filter(word != "radio") %>% 
  filter(word != "lot") %>% 
  filter(word != "episode") %>% 
  filter(word != "yeah") %>% 
  filter(word != "podcast") %>% 
  filter(word != "10") %>% 
  count(word, sort = T) %>% 
  filter(n > 1500) %>% 
  mutate(word = reorder(word, n))%>% 
  ggplot(aes(word, n)) +
    geom_col() +
    xlab(NULL) +
    coord_flip() +
    theme_fivethirtyeight()
#, height = 15, width = 7)

##################################  WORDCLOUD OF TOP WORDS  ##################################
ggsave('freak_wordcloud.png',
pod_test %>% 
  count(word) %>% 
  filter(word != "dubner") %>% 
  filter(word != "freakonomics") %>% 
  filter(word != "radio") %>% 
  filter(word != "lot") %>% 
  filter(word != "episode") %>% 
  filter(word != "yeah") %>% 
  filter(word != "podcast") %>% 
  filter(word != "10") %>% 
  with(wordcloud(word, n, max.words = 100))
)

as.character(pod_text[1,3])

##################################  SENTIMENT BY EPISODE  ##################################
pod_test %>% 
  inner_join(get_sentiments("bing")) %>% 
  add_count(word, sentiment) %>% 
  spread(sentiment, n, fill = 0) %>% 
  filter(id < 10000) %>% 
  mutate(sentiment = positive - negative) %>% 
  ggplot(aes(id, sentiment, fill = Title)) +
    geom_col(show.legend = F)

##################################  BI/TRIGRAMS  ##################################
freak_bigrams <- pod_text %>% 
  unnest_tokens(bigram, Text, token = "ngrams", n = 3) %>% 
  separate(bigram, c("word1", "word2", "word3"), sep = " ") %>% 
  filter(!word1 %in% c(stop_words$word, promo_words)) %>% 
  filter(!word2 %in% c(stop_words$word, promo_words)) %>% 
  filter(!word3 %in% c(stop_words$word, promo_words))

freak_bigrams %>% 
  count(word1, word2, word3, sort = T)
```


```{r}
podcast_words <- "Listen and subscribe to our podcast at Apple Podcasts, Stitcher, or elsewhere. Below is a transcript of the episode, edited for readability. For more information on the people and ideas in the episode, see the links at the bottom of this post. Freakonomics Radio is produced by Stitcher and Dubner Productions. This episode was produced by Daphne Chen. Our staff also includes Alison Craiglow, Greg Rippin, Matt Hickey, Corinne Wallace, Zack Lapinski, and Mary Diduch. Our intern is Emma Tyrrell; we had help this week from James Foster. Our theme song is "Mr. Fortune," by the Hitchhikers; all the other music was composed by Luis Guerra. You can subscribe to Freakonomics Radio on Apple Podcasts, Stitcher, or wherever you get your podcasts."


promo_words <- data.frame(podcast_words) %>% 
  mutate(podcast_words = as.character(podcast_words)) %>% 
  unnest_tokens(word, podcast_words)

```